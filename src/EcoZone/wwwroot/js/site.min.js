'use strict';

var app = angular.module('ecoZone',
[
    "ngRoute",
    "LocalStorageModule",
    "ngResource",
    "ui.router",
    "ngCookies",
    "ngProgress"
]);
app.config(routes);

function routes($stateProvider, $httpProvider, $urlRouterProvider) {
    //$httpProvider.interceptors.push("authInterceptorService");

    /*var Auth = function ($q, authService) {
     authService.fillAuthData();
     if (authService.authentication.isAuth) {
     return $q.when(authService.authentication);
     } else {
     return $q.reject({authenticated: false});
     }
     };*/

    $urlRouterProvider.otherwise("/");

    $stateProvider
        .state("main", {
            url: "/",
            templateUrl: "/home/index",
            controller: "mainController",
            abstract: true
        })
        .state("login", {
            url: "/login",
            templateUrl: "../app/account/login.html",
            controller: "loginController"
        })
        .state("signup", {
            url: "/signup",
            templateUrl: "../app/account/signup.html",
            controller: "signupController"
        })
        .state("profile", {
            url: "/profile",
            templateUrl: "../app/profile.html",
            controller: "profileController",
        })
        .state("users", {
            url: "/users",
            templateUrl: "../app/users.html",
            controller: "userController",
        })
        .state("settings", {
            url: "/settings",
            templateUrl: "../app/settings.html",
        })
        .state("help", {
            url: "/help",
            templateUrl: "../app/help.html",
        })
        .state("news", {
            url: "/news",
            templateUrl: "../app/news.html",
            controller: "newsController"
        })
        .state("navigation", {
            url: "/navigation",
            templateUrl: "../app/navigation.html",
            controller: "navigationController"
        });
}
app.run(run);

function run() {
    
};
// Write your Javascript code.

app.controller("loginController", loginController);

function loginController($scope) {

}
app.controller('mainController', mainController);

function mainController($scope) {
    $scope.title = 'EcoZone';
    $scope.description = 'экологический портал';
}
app.controller("navigationController", navigationController);

function navigationController($scope) {

}
app.controller("newsController", newsController);

function newsController($scope, newsService) {
    $scope.title = "Новости";

    $scope.news = [];

    newsService.getNews(function (data) {
        $scope.news = data;
    });
}
app.controller("profileController", profileController);

function profileController($scope) {

}
app.controller("signupController", signupController);

function signupController($scope) {

}
app.controller("userController", userController);
function userController($scope) {

}
app.factory("newsService", newsService);

function newsService($http) {
    var news = [];
    return {
        getNews: function (callback) {
            $http.get("/api/news")
                .success(function (data) {
                    news = data;
                    callback(data);
                })
                .error(function () {
                    console.error("Problem with getting news from the server");
                });
        }
    };
}